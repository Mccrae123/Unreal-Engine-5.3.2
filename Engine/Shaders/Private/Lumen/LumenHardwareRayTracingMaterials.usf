// Copyright Epic Games, Inc. All Rights Reserved.

#include "../Common.ush"
#include "../RayTracing/RayTracingCommon.ush"
#include "../RayTracing/RayTracingHitGroupCommon.ush"
#include "../Lumen/LumenHardwareRayTracingPayloadCommon.ush"

#include "../SceneData.ush"

RAY_TRACING_ENTRY_CLOSEST_HIT(LumenHardwareRayTracingMaterialCHS,
	FLumenMinimalPayload, Payload,
	FDefaultAttributes, Attributes)
{
	const int PrimitiveIndex = GetInstanceUserData();
	const int PrimitiveInstanceIndex = InstanceIndex() - GetBaseInstanceIndex();

	Payload.HitT = RayTCurrent();
	Payload.DistanceFieldObjectIndex = GetLumenDistanceFieldObjectIndex(PrimitiveIndex, PrimitiveInstanceIndex);

	// TODO: WorldNormal support
	// float3 LocalNormal = 0;
	// Payload.Normal = RotateLocalToWorld(LocalNormal, PrimitiveID());
}

RAY_TRACING_ENTRY_MISS(LumenHardwareRayTracingMaterialMS,
	FLumenMinimalPayload, Payload)
{
	Payload.SetMiss();
}
